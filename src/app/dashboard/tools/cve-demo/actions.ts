'use server';

/**
 * 这是一个简单的 Server Action 用于演示 CVE-2025-55182 漏洞
 *
 * 漏洞原理：
 * React Server Components 在处理 multipart/form-data 请求时，
 * 会对请求体中的数据进行反序列化。如果攻击者构造特殊的 payload，
 * 可以利用 Node.js 的 vm 模块在服务器上执行任意代码。
 *
 * 攻击 payload 格式：
 * {
 *   "id": "vm#runInThisContext",
 *   "bound": ["<恶意代码>"]
 * }
 */

export async function submitForm(formData: FormData): Promise<string> {
  const name = formData.get('name') as string;

  console.log('[Server Action] Received form submission:', {
    name,
    timestamp: new Date().toISOString()
  });

  // 模拟处理延迟
  await new Promise((resolve) => setTimeout(resolve, 100));

  if (!name || name.trim() === '') {
    return '请输入用户名';
  }

  return `Hello, ${name}! 表单提交成功。`;
}
